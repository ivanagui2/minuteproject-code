#exposeOXVariableActionSpecific()
#set ($defaultImplementationCRUD=$action.hasDefaultImplementation())
#set ($defaultImplementationIsInsert=$action.hasDefaultImplementation("insert"))
#set ($defaultImplementationIsUpdate=$action.hasDefaultImplementation("update"))
package $packageName;

import javax.persistence.*;

import $domainImport; 

import org.openxava.jpa.*;
import org.openxava.model.*;
import org.openxava.util.*;
import org.openxava.validators.*;
import org.openxava.actions.*;

$!updatedAreaImport

public class ${className} extends ViewBaseAction {

	public void execute() throws Exception {
#exposeModelUpdatedAreas("execute")
$!updatedAreaBegin
#if($isUpdated)
$!updatedAreaSnippet
#else 
        //super.execute();
        //TODO
        Messages errors =
            MapFacade.validate("${domainClassName}", getView().getValues());
        if (errors.contains()) throw new ValidationException(errors);
#if ($defaultImplementationCRUD)		
        EntityManager em = XPersistence.getManager();
        try {
	        ${domainClassName} e = new ${domainClassName}();
#if($defaultImplementationIsUpdate)
#set($mask=$formatUtils.addDoubleQuotes("$primaryKeyVariable"))
#set($entityMask=$columnUtils.getMask($primaryKeyFirstColumn, "getView().getValueString($mask)"))
			e.set${primaryKeyJavaNameClass}($entityMask);
			e = XPersistence.getManager().find(${domainClassName}.class, e.get${primaryKeyJavaNameClass}());
            //check display condition
#foreach ($field in ${action.actionCondition.fields})
#set($column=$columnUtils.getColumn($table, $field.name))
#putColumnParamNaming()
#set($conditionColumnValue=$action.actionCondition.getConditionColumnValue($column, $field))
		    if (${conditionColumnValue}.equals(e.get${columnClass}()))
				errors.add ("Condition ${action.actionCondition.name} not met!");
#end
#end
			// set init condition	
			// copy field from form
#foreach ($column in ${table.columns})
#putColumnParamNaming()
		    e.set${columnClass}(getView().getValueString("${columnVar}"));
#end
			// assign field
#foreach ($field in ${action.fields})
#set($column=$columnUtils.getColumn($table, $field.name))
#putColumnParamNaming()
#set($columnValue=$columnUtils.getMask($column, $field.value))
		    e.set${columnClass}(${columnValue});
#end
#if($defaultImplementationIsUpdate || $defaultImplementationIsInsert)
			XPersistence.getManager().persist(e); 
#end
			getView().reset();
			resetDescriptionsCache();
        } catch (Exception e) {
            errors = new Messages();
            errors.add(e.getMessage());
            throw new ValidationException(errors);
        }
#else
		addWarning ("Please implement me!)");
#end
/*        EntityManager em = XPersistence.getManager();
        try {
            query.getResultList();
        } catch (Exception e) {
            Messages errors = new Messages();
            throw new ValidationException(errors);
        }
		*/
        //TODO return list
        addInfo("call ${className} done!");
#end
$!updatedAreaEnd

	}

$!updatedAreaImplementation

}