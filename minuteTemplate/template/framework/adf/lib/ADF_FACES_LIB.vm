#macro (exposeADFFacesCommon)
#set($separator=$i18nUtils.getSeparator($template))
#end

#macro (adfEntityColumnDisplay $id)
#if($columnUtils.hasCheckConstraint($column))
                        <af:selectOneChoice label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}" 
							value="#{viewScope.${entityADFVariable}BackingBean.search${entityADFVariable}.${columnVar}}"
							id="${id}"
							shortDesc="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}">
                          <f:selectItems value="#{viewScope.${entityADFVariable}BackingBean.${entityADFVariable}.${columnVar}Enum}" id="${id}Items"/>
                        </af:selectOneChoice>
#else
                        <af:inputText label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
                                      id="${id}" ##columns="40" ##columns="$column.size"
#adfBackingBean("viewScope", "${entityADFVariable}BackingBean", "search${entityADFVariable}")
                        />
#end
#end

#macro (adfEntityEditColumnDisplay $id)
#adfEntityEditColumnDisplayWithScope($id, "${entityADFVariable}BackingBean", "viewScope", "false" )
#end

#macro (adfSddInputColumnDisplay $id)
#adfEntityEditColumnDisplayWithScope($id, "${queryBackingBeanADFFaceVariable}", "pageFlowScope", "false" )
#end

#macro (adfEntityEditColumnDisplay4PageFlow $id, $isDisabled)
#adfEntityEditColumnDisplayWithScope($id, "${viewEditEntityBeanVariable}", "pageFlowScope", $isDisabled)
#end

#macro (adfEntityEditColumnDisplayWithScope $id $bean $scope $isDisabled)
#if($isPrimaryKey && !$columnUtils.isNaturalPk($column))
	
##elseif($columnUtils.isForeignKey($column) && )
#else
#if($presentationUtils.isParentDropDownList($column) )
                        <af:selectOneChoice label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}" 
                            value="#{${scope}.${bean}.${entityADFVariable}.${columnVar}_}"
                            id="${id}" required="$isMandatory" disabled="$isDisabled"
                            shortDesc="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}">
                          <f:selectItems value="#{${scope}.${bean}.${columnVar}List}" id="${id}Items"/>
                        </af:selectOneChoice>	
#elseif($columnUtils.hasCheckConstraint($column))
                        <af:selectOneChoice label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}" 
                            value="#{${scope}.${bean}.${entityADFVariable}.${columnVar}}"
                            id="${id}" required="$isMandatory" disabled="$isDisabled"
                            shortDesc="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}">
                          <f:selectItems value="#{${scope}.${bean}.${entityADFVariable}.${columnVar}Enum}" id="${id}Items"/>
                        </af:selectOneChoice>
#elseif($presentationUtils.isCheckBox($column))
                        <af:selectBooleanCheckbox label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
                            value="#{${scope}.${bean}.${entityADFVariable}.${columnVar}}" disabled="$isDisabled"
                            id="$id" shortDesc="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"/>	
#elseif ($presentationUtils.isRichTextOnly($column))
                        <af:richTextEditor label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}" id="$id"/>	
#elseif($presentationUtils.isFileUpload($column))
##TODO	
#else
#if ($columnUtils.isTimeColumn($column))
                        <af:inputDate
#else
                        <af:inputText
#end
                            label="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
                            id="${id}" 
#if (!$columnUtils.isTimeColumn($column))
##                            columns="$adfUtils.getPrecision($column)"
                            columns="$adfUtils.getDisplayColumns($column)"
                            rows="$adfUtils.getDisplayRows($column)"
#else
                            columns="10"
#end
                            required="$isMandatory"
                            disabled="$isDisabled"
#adfBackingBean($scope, $bean, ${entityADFVariable})
                            shortDesc="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
#if ($columnUtils.isTimeColumn($column))
                        >
                            <af:convertDateTime pattern="dd/MM/yyyy" />
                       </af:inputDate>
#else
                        />
#end
			 
#end
#end
#end

#macro(adfBackingBean $scope $bean $variable)
#if($isForeignKey)
                            value="#{${scope}.${bean}.${variable}.${columnVar}_}"
#else
                            value="#{${scope}.${bean}.${variable}.${columnVar}}"
#end
#end
#############
############# macro direct binding
#############
#macro (adfEntityEditColumnDisplayForBindings $id)
#if ($columnUtils.isTimeColumn($column))
                                            <af:inputDate value="#{bindings.${columnClass}.inputValue}"
                                                          label="#{bindings.${columnClass}.hints.label}"
                                                          required="#{bindings.${columnClass}.hints.mandatory}"
                                                          columns="#{bindings.${columnClass}.hints.displayWidth}"
                                                          shortDesc="#{bindings.${columnClass}.hints.tooltip}" id="$id">
                                                <f:validator binding="#{bindings.${columnClass}.validator}"/>
                                                <af:convertDateTime pattern="#{bindings.${columnClass}.format}"/>
                                            </af:inputDate>
#else
                                            <af:inputText value="#{bindings.${columnClass}.inputValue}"
                                                          label="#{bindings.${columnClass}.hints.label}"
                                                          required="#{bindings.${columnClass}.hints.mandatory}"
                                                          columns="#{bindings.${columnClass}.hints.displayWidth}"
                                                          maximumLength="#{bindings.${columnClass}.hints.precision}"
                                                          shortDesc="#{bindings.${columnClass}.hints.tooltip}" id="$id">
                                                <f:validator binding="#{bindings.${columnClass}.validator}"/>
                                            </af:inputText>
#end
#end


#######################################################################
############# macro table
#######################################################################

#macro(adfEntityTable $table $adfIdAppender $tableVariableName $listVariable $scope $bean $isChild)
#set($windowHeight="$adfUtils.getDisplayWindowDetailsHeight($table)")##"400")
#set($windowWidth="$adfUtils.getDisplayWindowDetailsWidth($table)")##"600")
#set($resultListWidth="600px")
<af:showDetailItem text="#{viewcontrollerBundle['$tableVariableName$separator$listVariable']}"
                                 id="sdChildren$adfIdAppender">
                 <af:panelGroupLayout layout="horizontal" halign="left"
                        rendered="#{${scope}.${bean}.displayResults}">
                    <af:panelBox id="${entityADFVariable}__pb_${adfIdAppender}" showDisclosure="false"
                                 showHeader="always" ramp="core"
                                 styleClass="section">
                      <af:pageTemplate viewId="/WEB-INF/common/tableCollectionTemplate.jspx"
                                       id="tableTmpl_${adfIdAppender}">
                        <f:facet name="table">
                        <af:table id="table_${adfIdAppender}"
#if(!$isChild)
                                    value="#{bindings.${domainVariableName}DTOs.collectionModel}"
                                    emptyText="#{bindings.${domainVariableName}DTOs.viewable ? 'No data to display.' : 'Access Denied.'}"
                                    filterModel="#{bindings.${domainVariableName}DTOsQuery.queryDescriptor}"
                                    rows="#{${scope}.${bean}.${entityADFVariable}Table.rangeSize}"
                                    fetchSize="#{${scope}.${bean}.${entityADFVariable}Table.rangeSize}"
                                    queryListener="#{${scope}.${bean}.${entityADFVariable}Table.queryListener}"
                                    binding="#{${scope}.${bean}.${entityADFVariable}Table.tableUIComp}"
#else
                                    value="#{${scope}.${bean}.${listVariable}Children}"
#end
                                    var="row"
                                    rowBandingInterval="1"
                                    filterVisible="true"
                                    columnResizing="disabled" autoHeightRows="0"
                                    varStatus="vs" rowSelection="none"
                                    width="${resultListWidth}" contentDelivery="immediate"
                                    immediate="true"
                                    >
##pk
#exposeModelUpdatedAreas("list-node")
$!updatedAreaBegin
#if($isUpdated)
$!updatedAreaSnippet
#else 
##foreach ($column in $table.columns)  
#foreach ($column in $presentationUtils.getPotentialDisplayableColumns($table))  
#putColumnParamNaming()
#if($isPrimaryKey)
                            <af:column sortProperty="${columnVar}" sortable="true"
                                       filterable="true"
#if($columnUtils.isNaturalPk($column))
                                       headerText="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
#else
                                       headerText="Reference"	
#end
                                       id="${columnVar}_id_${adfIdAppender}" width="$adfUtils.getDisplayColumnWithHeader($column)">
                              <af:commandLink id="${columnVar}_${adfIdAppender}"
#if($columnUtils.isNaturalPk($column))
                                              text="#{row.${columnVar}}" 
#else
                                              text="view" 
#end
                                              action="details" immediate="true"
                                              partialSubmit="true"
                                              useWindow="true"
                                              windowEmbedStyle="inlineDocument"
                                              windowModalityType="applicationModal"
                                              windowHeight="$windowHeight"
                                              windowWidth="$windowWidth"
                                              launchListener="#{${scope}.${bean}.handleLaunchEdit${entityADFClass}Dlg}">
##works for one pk only
                                <f:attribute name="${entityADFVariable}Reference" value="#{row.${columnVar}}"/>
                              </af:commandLink>
                            </af:column>
#else
                            <af:column sortProperty="${columnVar}" sortable="true"
                                       filterable="true"
                                       headerText="#{viewcontrollerBundle['$tableVariableName$separator$columnVar']}"
                                       id="${columnVar}_col_${adfIdAppender}" width="$adfUtils.getDisplayColumnWithHeader($column)">
#if($isForeignKey)
#set($columnVar = "${columnVar}_")
#end
                              <af:outputText value="#{row.${columnVar}}" id="${columnVar}_ot_${adfIdAppender}"/>
                            </af:column>
#end
#end
#end
$updatedAreaEnd
                          </af:table>
                      </f:facet>
                        <f:attribute name="paginationUtils"
                                     value="#{${scope}.${bean}.${entityADFVariable}Table}"/>
                      </af:pageTemplate>
                    </af:panelBox>
                  </af:panelGroupLayout>
              </af:showDetailItem>
#end